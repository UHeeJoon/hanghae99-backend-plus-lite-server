> 🔸현재 작성된 `입력` 및 `출력`은 언제든 변경될 가능성이 높음

# 기능 ID: 01
## 기능명: 대기열 토큰 발급

- **설명**: 유저가 예약 서비스를 이용하기 위해 대기열에 진입하고, 유효한 토큰을 발급받습니다.

### 🔸 입력
| 항목 | 타입 | 필수 여부 | 제약사항 |
|------|------|------------|----------|
| userId | UUID | Y | 유효한 UUID 형식 |

### 🔸 출력
```json
{
  "token": "token_...",
  "queuePosition": 12,
  "estimatedWaitTimeSeconds": 180
}
```

### 🔸 처리 흐름
1. userId로 대기열에 등록 (중복 방지)
2. 현재 대기열 기준으로 순번/예상 대기 시간 계산
3. JWT 토큰 생성 (대기열 정보 포함)
4. 토큰 및 메타 정보 반환

### 🔸 예외 조건
- 이미 활성 토큰이 있는 경우 → 409 Conflict
- UUID 형식 오류 → 400 Bad Request

### 🔸 비고
- JWT 서명 포함 (예: HS256, 유효기간 15분)
- Redis를 통한 대기열 구현 고려

---

# 기능 ID: 02
## 기능명: 예약 가능 날짜 조회

- **설명**: 예약 가능한 콘서트 날짜 목록을 조회합니다.

### 🔸 입력
없음

### 🔸 출력 예시
```json
["2025-06-01", "2025-06-02", "2025-06-03"]
```

### 🔸 처리 흐름
1. 현재 날짜 이후 예약 가능한 날짜를 DB에서 조회
2. JSON 배열로 반환

### 🔸 비고
- 일반적으로 7일치 예약 오픈

---

# 기능 ID: 03
## 기능명: 좌석 목록 조회

- **설명**: 특정 날짜의 좌석 번호와 현재 상태를 조회합니다.

### 🔸 입력
| 항목 | 타입 | 필수 여부 |
|------|------|-----------|
| date | string (yyyy-MM-dd) | Y |

### 🔸 출력 예시
```json
[
  { "seatNumber": 1, "status": "AVAILABLE" },
  { "seatNumber": 2, "status": "HELD", "holdExpireAt": "2025-06-01T14:03:00" },
  { "seatNumber": 3, "status": "RESERVED" }
]
```

### 🔸 처리 흐름
1. 해당 날짜 좌석 목록 조회
2. 상태(예약 가능, 임시 보류, 확정 예약) 판별
3. 결과 반환

### 🔸 상태 정의
- `AVAILABLE`: 예약 가능
- `HELD`: 다른 사용자에 의해 임시 배정 중
- `RESERVED`: 결제 완료

---

# 기능 ID: 04
## 기능명: 좌석 예약 요청

- **설명**: 유저가 원하는 날짜와 좌석을 지정해 임시 배정합니다.

### 🔸 입력
| 항목 | 타입 | 필수 여부 |
|------|------|-----------|
| userId | UUID | Y |
| token | string | Y |
| date | string (yyyy-MM-dd) | Y |
| seatNumber | int | Y (1~50) |

### 🔸 출력 예시
```json
{
  "status": "HELD",
  "holdExpireAt": "2025-06-01T14:05:00"
}
```

### 🔸 처리 흐름
1. 토큰 유효성 및 대기열 통과 여부 검증
2. 좌석 상태 확인 (Redisson Lock 등 동시성 제어)
3. 좌석 임시 배정 (예: Redis에 TTL 5분 저장)
4. 응답 반환

### 🔸 예외 조건
- 좌석이 이미 예약되었거나 임시 배정된 경우 → 409 Conflict
- 토큰 만료 → 401 Unauthorized

---

# 기능 ID: 05
## 기능명: 잔액 충전

- **설명**: 유저가 미리 잔액을 충전하여 예약에 사용할 수 있도록 합니다.

### 🔸 입력
| 항목 | 타입 | 필수 여부 |
|------|------|-----------|
| userId | UUID | Y |
| amount | int | Y (단위: 원, 0 초과) |

### 🔸 출력 예시
```json
{ "balance": 35000 }
```

### 🔸 처리 흐름
1. 유저 계정 및 잔액 정보 조회
2. 기존 잔액에 금액 추가
3. 결과 반환

### 🔸 예외 조건
- amount ≤ 0 → 400 Bad Request

---

# 기능 ID: 06
## 기능명: 잔액 조회

- **설명**: 유저의 현재 보유 잔액을 조회합니다.

### 🔸 입력
| 항목 | 타입 | 필수 여부 |
|------|------|-----------|
| userId | UUID | Y |

### 🔸 출력 예시
```json
{ "balance": 27000 }
```

### 🔸 처리 흐름
1. 유저 계정 조회
2. 현재 잔액 반환

---

# 기능 ID: 07
## 기능명: 결제

- **설명**: 임시 배정된 좌석에 대해 실제 결제를 수행하고, 소유권을 확정합니다.

### 🔸 입력
| 항목 | 타입 | 필수 여부 |
|------|------|-----------|
| userId | UUID | Y |
| token | string | Y |
| date | string | Y |
| seatNumber | int | Y |

### 🔸 출력 예시
```json
{
  "status": "PAID",
  "remainingBalance": 17000
}
```

### 🔸 처리 흐름
1. 토큰 유효성 및 대기열 통과 여부 검증
2. 임시 배정 상태 확인 (TTL 유효 확인)
3. 잔액 확인 및 차감
4. 결제 내역 기록
5. 좌석 상태 업데이트 → RESERVED
6. 대기열 토큰 만료 처리

### 🔸 예외 조건
- 잔액 부족 → 402 Payment Required
- 좌석 배정이 만료된 경우 → 410 Gone

---